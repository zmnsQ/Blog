(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-473713d9"],{"28e4":function(e,t,n){"use strict";n.r(t),n.d(t,"cameraList",(function(){return i})),n.d(t,"Tree",(function(){return o})),n.d(t,"initInfo",(function(){return l}));var a=n("b775");function i(e){return Object(a["a"])({url:"/api/resourceCameraUrls",method:"get",params:e})}function o(e){return Object(a["a"])({url:"/api/resource/Tree",method:"get"})}function l(){return Object(a["a"])({url:"/api/Initkey",method:"get"})}t["default"]={cameraList:i,Tree:o,initInfo:l}},"3ce5":function(e,t,n){},4606:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"top-header"},[n("el-date-picker",{attrs:{type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"]},on:{change:e.changeTime},model:{value:e.query.time,callback:function(t){e.$set(e.query,"time",t)},expression:"query.time"}}),e._v(" "),n("el-select",{attrs:{placeholder:"事件类型"},on:{change:e.changeEventType},model:{value:e.query.eventType,callback:function(t){e.$set(e.query,"eventType",t)},expression:"query.eventType"}},e._l(e.eventType,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e._v(" "),n("el-select",{attrs:{placeholder:"事件等级"},on:{change:e.changeAlarmType},model:{value:e.query.alarmType,callback:function(t){e.$set(e.query,"alarmType",t)},expression:"query.alarmType"}},e._l(e.alarmType,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.queryData()}}},[e._v("查询")])],1),e._v(" "),n("div",[n("el-table",{staticStyle:{width:"100%",margin:"10px auto"},attrs:{data:e.eventListData.list,border:"",stripe:""}},[n("el-table-column",{attrs:{prop:"startTime",label:"时间",formatter:e.dateFormat}}),e._v(" "),n("el-table-column",{attrs:{prop:"ruleName",label:"规则名称"}}),e._v(" "),n("el-table-column",{attrs:{prop:"eventLogSrcList",label:"所在区域/位置"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.eventLogSrcList[0].regionName))]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"eventTypeName",label:"事件类型"}}),e._v(" "),n("el-table-column",{attrs:{prop:"eventLogSrcList",label:"事件源文"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.eventLogSrcList[0].resName))]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"eventLevelValue,eventLevelColor",label:"事件等级",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{style:e.cellStyle(t.row.eventLevelColor)},[e._v(e._s(t.row.eventLevelValue))])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"handleStatus",label:"处理状态",formatter:e.statusFormat}}),e._v(" "),n("el-table-column",{attrs:{prop:"eventLogSrcList",label:"联动信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{icon:"el-icon-search",circle:""},on:{click:function(n){return e.handleClick(t.row.eventLogSrcList)}}})]}}])})],1)],1),e._v(" "),n("div",{staticClass:"paginatio"},[n("el-pagination",{attrs:{"current-page":e.eventListData.pageNo,"page-sizes":[13,30,40,50,100],"page-size":e.eventListData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.eventListData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),n("pop-table",{attrs:{show:e.popShow,"event-log-src-list":e.eventLog},on:{returnPop:e.popTableReturn}})],1)},i=[],o=(n("ac6a"),n("e0737")),l=n("db5e"),r=n("c1df"),s=n.n(r),c={name:"EventList",components:{PopTable:o["default"]},data:function(){return{popShow:0,popCShow:0,headerIndex:"1",eventListData:[],eventLog:[],query:{eventType:"",alarmType:"null",currentPage:1,pageSize:13,time:[]},eventType:[{value:"",label:"全部"},{value:"131588",label:"区域入侵"},{value:"131329",label:"视频丢失"},{value:"131330",label:"视频遮挡"},{value:"131331",label:"移动侦测"},{value:"131612",label:"场景变更"},{value:"589825",label:"报警输入"},{value:"589826",label:"报警输出"},{value:"131585",label:"越界侦测"},{value:"192518",label:"温差报警"},{value:"192517",label:"温度报警"},{value:"192515",label:"火点检测"},{value:"192514",label:"烟火检测"},{value:"192513",label:"烟雾检测"}],alarmType:[{value:"null",label:"全部"},{value:"1",label:"低"},{value:"2",label:"中"},{value:"3",label:"高"}]}},created:function(){var e=new Date,t=new Date(e.getTime()-864e5),n=new Date(e.getTime()+864e5);this.query.time.push(t,n),this.queryData()},methods:{cellStyle:function(e){return"background:".concat(e,"; color:#ffffff; text-align:center; width: 100%;height: 100%;display: block;")},handleClick:function(e){this.eventLog=e,this.popShow=1},popTableReturn:function(e){this.popShow=0},changeTime:function(e){this.query.time=e,this.queryData()},changeEventType:function(e){this.query.eventType=e,this.queryData()},changeAlarmType:function(e){this.query.alarmType=e,this.queryData()},queryData:function(){var e=this;l["default"].eventList(this.query).then((function(t){t.data.list.forEach((function(e){for(var t=0;t<e.eventLogSrcList.length;t++)e.eventLogSrcList[t].data=JSON.parse(e.eventLogSrcList[t].data),e.eventLogSrcList[t].data.recvTime=s()(e.eventLogSrcList[t].data.recvTime).format("YYYY-MM-DD HH:mm:ss"),e.eventLogSrcList[t].data.sendTime=s()(e.eventLogSrcList[t].data.sendTime).format("YYYY-MM-DD HH:mm:ss")})),e.eventListData=t.data}))},handleSizeChange:function(e){this.query.pageSize=e,this.queryData()},handleCurrentChange:function(e){this.query.currentPage=e,this.queryData()},dateFormat:function(e,t){var n=e[t.property];return void 0===n?"":s()(n).format("YYYY-MM-DD HH:mm:ss")},statusFormat:function(e,t){var n;switch(e.handleStatus){case 0:n="未处理";break;case 1:n="已处理";break}return n}}},u=c,p=n("2877"),v=Object(p["a"])(u,a,i,!1,null,"656a9003",null);t["default"]=v.exports},d30a:function(e,t,n){"use strict";n("3ce5")},db5e:function(e,t,n){"use strict";n.r(t),n.d(t,"eventList",(function(){return i})),n.d(t,"eventList2",(function(){return o}));var a=n("b775");function i(e){return Object(a["a"])({url:"/api/EventList",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/api/event/intrusion",method:"post",data:e})}t["default"]={eventList:i,eventList2:o}},e0737:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.show?n("div",{staticClass:"pop-div"},[n("div",{staticClass:"pop-bg",class:e.show&&e.animation?"popbg-in":"popbg-out"}),e._v(" "),n("div",{staticClass:"pop-content",class:e.show&&e.animation?"popcontent-in":"popcontent-out"},[n("div",{staticClass:"pop-title"},[n("div",{staticClass:"title-font"},[e._v("联动列表")]),e._v(" "),n("div",{staticClass:"title-img",on:{click:e.close}},[n("svg-icon",{staticStyle:{width:"100%",height:"100%"},attrs:{"icon-class":"close"}})],1)]),e._v(" "),n("div",{staticClass:"pop-table"},[n("el-table",{staticStyle:{width:"100%",height:"100%"},attrs:{data:e.eventLogSrcList,stripe:""}},[n("el-table-column",{attrs:{type:"index",align:"center",fixed:"",label:"序号",width:"50"}}),e._v(" "),n("el-table-column",{attrs:{prop:"resName",align:"center",label:"事件源名称"}}),e._v(" "),n("el-table-column",{attrs:{prop:"eventTypeName",align:"center",label:"事件类型"}}),e._v(" "),n("el-table-column",{attrs:{prop:"regionName",align:"center",label:"所属区域名称"}}),e._v(" "),n("el-table-column",{attrs:{prop:"data.recvTime",align:"center",label:"发生时间"}}),e._v(" "),n("el-table-column",{attrs:{prop:"data.sendTime",align:"center",label:"结束时间"}}),e._v(" "),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{staticClass:"videoBut",attrs:{type:"primary",icon:"el-icon-video-camera",circle:""},on:{click:function(n){return e.videoOpen(t.row.resIndexCode)}}})]}}],null,!1,3741938866)})],1)],1),e._v(" "),n("div",{staticClass:"pop-page"},[n("el-pagination",{attrs:{background:"","page-size":e.pageSize,"current-page":e.currentPpage,layout:"pager",total:e.total}})],1)]),e._v(" "),e.videoshow?n("div",{staticClass:"video"},[n("div",{staticClass:"playWnd",staticStyle:{width:"320px",height:"320px"},attrs:{id:"playAlarm"}})]):e._e()]):e._e()},i=[],o=(n("a481"),n("1157")),l=n.n(o),r=n("28e4"),s={props:["show","eventLogSrcList"],data:function(){return{animation:1,total:20,currentPpage:1,evevtlogdata:[],pageSize:10,videoshow:0,activeName:"first",initCount:0,initparam:{appKey:"",secret:"",apiIp:"",apiPort:443,layout:"1x1"},wndId:1,pointCode:"",pubKey:"",oWebControl:null,WebControl:null}},watch:{eventLogSrcList:function(e,t){this.total=e.lenght+15,this.pagination(this.currentPpage,this.pageSize,this.evevtlogdata),this.evevtlogdata=e}},methods:{close:function(){this.animation=0,null!==this.oWebControl&&this.stopAllPreview(),this.closeWindow(),this.videoshow=0;var e=this;setTimeout((function(){e.$emit("returnPop",0),e.animation=1}),500)},pagination:function(e,t,n){var a=(e-1)*t;return a+t>=n.length?n.slice(a,n.length):n.slice(a,a+t)},videoOpen:function(e){this.pointCode=e,0===this.videoshow?(this.videoshow=1,this.getInitParam(),this.WebControl=WebControl,this.initPlugin()):(this.videoshow=0,this.stopAllPreview(),this.closeWindow())},getInitParam:function(){var e=this;r["default"].initInfo().then((function(t){e.initparam=t.data,e.init()}))},videoPreview:function(){this.startpreview()},initPlugin:function(){var e=this;this.oWebControl=new WebControl({szPluginContainer:"playAlarm",iServicePortStart:15900,iServicePortEnd:15909,szClassId:"23BF3B0A-2C56-4D97-9C03-0CB103AA8F11",cbConnectSuccess:function(){e.initCount=0,e.oWebControl.JS_StartService("window",{dllPath:"./VideoPluginConnect.dll"}).then((function(){e.oWebControl.JS_SetWindowControlCallback({cbIntegrationCallBack:e.cbIntegrationCallBack}),e.oWebControl.JS_CreateWnd("playAlarm",320,320).then((function(){e.init()}))}),(function(){}))},cbConnectError:function(){e.oWebControl=null,l()("#playAlarm").html("<p>&nbsp;插件未启动，正在尝试启动，请稍候...</p>"),e.WebControl.JS_WakeUp("VideoWebPlugin://"),e.initCount++,e.initCount<3?setTimeout((function(){e.initPlugin()}),3e3):l()("#playAlarm").html('<p>&nbsp;插件启动失败，请安装插件!</p><a style="color:#0c5890" href="../VideoWebPlugin.exe" download="VideoWebPlugin.exe" >下载地址</a>')},cbConnectClose:function(t){e.oWebControl=null}})},setCallbacks:function(){this.oWebControl.JS_SetWindowControlCallback({cbIntegrationCallBack:this.cbIntegrationCallBack})},cbIntegrationCallBack:function(e){this.wndId=e.responseMsg.msg.wndId},init:function(){var e=this;this.getPubKey((function(){var t=e.initparam.appKey,n=e.setEncrypt(e.initparam.secret),a=e.initparam.apiIp,i=e.initparam.apiPort;i=parseInt(i);var o=0,l="D:\\SnapDir",r="D:\\VideoDir",s=1,c="secret",u=1,p=0,v="0,16,256,257,258,259,260,512,513,514,515,516,517,768,769";e.oWebControl.JS_RequestInterface({funcName:"init",argument:JSON.stringify({appkey:t,secret:n,ip:a,playMode:o,port:i,snapDir:l,videoDir:r,layout:"1x1",enableHTTPS:s,encryptedFields:c,showToolbar:u,showSmart:p,buttonIDs:v})}).then((function(t){e.oWebControl.JS_Resize(320,320),e.videoPreview()}))}))},getPubKey:function(e){var t=this;this.oWebControl.JS_RequestInterface({funcName:"getRSAPubKey",argument:JSON.stringify({keyLength:1024})}).then((function(n){n.responseMsg.data&&(t.pubKey=n.responseMsg.data,e())}))},setEncrypt:function(e){var t=new JSEncrypt;return t.setPublicKey(this.pubKey),t.encrypt(e)},startpreview:function(){var e=this.pointCode,t=e,n=0,a=1,i=0;this.wndId;t=t.replace(/(^\s*)/g,""),t=t.replace(/(\s*$)/g,""),this.oWebControl.JS_RequestInterface({funcName:"startPreview",argument:JSON.stringify({cameraIndexCode:t,streamMode:n,transMode:a,gpuMode:i})})},stopAllPreview:function(){this.oWebControl.JS_RequestInterface({funcName:"stopAllPreview"})},closeWindow:function(){null!=this.oWebControl&&(this.oWebControl.JS_HideWnd(),this.oWebControl.JS_Disconnect().then((function(){}),(function(){})))}}},c=s,u=(n("d30a"),n("2877")),p=Object(u["a"])(c,a,i,!1,null,"62063409",null);t["default"]=p.exports}}]);